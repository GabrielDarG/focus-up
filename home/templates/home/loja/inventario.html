{% extends 'home/base.html' %}
{% load static %}

{% block title %}Meu Inventário - FocusUP{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'home/css/estiloinventario.css' %}?v=6" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
{% endblock extra_head %}

{% block content %}
<div class="inventario-container">
    
    <header class="inventario-header">
        <h1>Minha Mochila</h1>
        <p class="subtitulo">Seus itens, conquistas e ferramentas.</p>
        
        <div class="nav-botoes">
            <a href="{% url 'home:loja_view' %}" class="btn-nav btn-loja">
                <i class="bi bi-shop"></i> Ir para Loja
            </a>
            <a href="{% url 'home:lista_Tarefas' %}" class="btn-nav btn-tarefas">
                <i class="bi bi-list-check"></i> Tarefas
            </a>
        </div>
    </header>

    {% if messages %}
    <div class="mensagens-container">
        {% for message in messages %}
        <div class="mensagem {{ message.tags }}">
            <i class="bi bi-info-circle-fill"></i> {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="grid-inventario">
        {% for slot in meus_itens %}
        <div class="card-inv {% if slot.item.tipo_efeito == 'SLOT_EXTRA' or not slot.item.eh_consumivel %}item-permanente{% endif %}">
            
            <div class="inv-icon-wrapper {{ slot.item.classe_css }}">
                <i class="bi {{ slot.item.icone_bootstrap }}"></i>
                
                {% if slot.item.eh_consumivel %}
                    <span class="badge-qtd">{{ slot.quantidade }}x</span>
                {% else %}
                    <span class="badge-qtd perm">∞</span>
                {% endif %}
            </div>

            <div class="inv-info">
                <h3>{{ slot.item.nome }}</h3>
                <p>{{ slot.item.descricao }}</p>
            </div>

            <div class="inv-action">
                
                {% if slot.item.tipo_efeito == 'CONGELADOR' %}
                    <button class="btn-inv btn-passivo" disabled>
                        <i class="bi bi-shield-lock"></i> Passivo (Automático)
                    </button>

                {% elif slot.item.tipo_efeito == 'XP_BOOST' %}
                    {% if slot.esta_ativo %}
                        <button class="btn-inv btn-ativo" disabled>
                            <i class="bi bi-lightning-fill"></i> Ativo Agora!
                        </button>
                    {% else %}
                        <form action="{% url 'home:ativar_item' slot.item.id %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn-inv btn-usar">
                                <i class="bi bi-magic"></i> Usar Agora
                            </button>
                        </form>
                    {% endif %}

                {% elif slot.item.tipo_efeito == 'SLOT_EXTRA' %}
                    <button class="btn-inv btn-passivo" disabled>
                        <i class="bi bi-check-circle-fill"></i> Equipado (+{{ slot.quantidade }})
                    </button>

                {% elif slot.item.tipo_efeito == 'MOLDURA' or slot.item.tipo_efeito == 'AVATAR' or slot.item.tipo_efeito == 'COR_BORDA' %}
                    
                    {% if slot.item.tipo_efeito == 'COR_BORDA' and slot.esta_ativo %}
                        <form action="{% url 'home:ativar_item' slot.item.id %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn-inv btn-usar" style="background-color: #e84118;">
                                <i class="bi bi-x-circle"></i> Remover Cor
                            </button>
                        </form>

                    {% elif slot.esta_ativo %}
                        <button class="btn-inv btn-passivo" disabled>
                            <i class="bi bi-check-circle-fill"></i> Equipado
                        </button>
                    
                    {% else %}
                        <form action="{% url 'home:ativar_item' slot.item.id %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn-inv btn-usar">
                                Equipar
                            </button>
                        </form>
                    {% endif %}

                {% else %}
                    <form action="{% url 'home:ativar_item' slot.item.id %}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn-inv btn-usar">Usar</button>
                    </form>
                {% endif %}

            </div>
        </div>
        {% empty %}
        <div class="inventario-vazio">
            <div class="icon-vazio"><i class="bi bi-box-seam"></i></div>
            <h2>Sua mochila está vazia!</h2>
            <p>Visite a loja e gaste suas moedas para conseguir itens poderosos.</p>
            <a href="{% url 'home:loja_view' %}" class="btn-cta-loja">Visitar Loja</a>
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}